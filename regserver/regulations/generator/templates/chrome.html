{% extends "base.html" %}

{% block body %}

{% comment %}
    Page-level template for everything but notices.
{% endcomment %}

<!--[if lt IE 8]>
    <p class="browser-warning">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->

<header id="site-header" class="reg-header">
<div class="main-head">
    <div class="reg-title">
        <h1><a href="{% url 'regulation_landing_view' reg_part %}">{{ meta.cfr_title_number }} CFR Part {{ reg_part }} <span class="title">{{ meta.title }} {{meta.statutory_name|title}} </span>{% if meta.reg_letter %}(Regulation {{ meta.reg_letter }}){% endif %}</a></h1>
    </div> <!-- /reg-title -->
    {% include "logo.html" %} 
</div>

<div class="sub-head">
    <a href="#content-wrapper" class="hidden-text">Skip to main content</a> <!-- skip to content link for screen readers-->
    <div class="toc-head">
        <a href="#" id="panel-link" class="toc-toggle panel-slide"><span class="icon-text">Navigation</span></a>
        <ul class="drawer-toggles">
            <li><a href="#table-of-contents" id="menu-link" class="toc-nav-link current" title="Table of Contents"><span class="icon-text">Table of Contents</span><span class="minicon-menu"></span></a></li>
            <li><a href="#history" id="history-link" class="toc-nav-link" title="History"><span class="icon-text">History</span><span class="minicon-history"></span></a></li>
            <li><a href="#search" id="search-link" class="toc-nav-link" title="Search"><span class="icon-text">Search</span><span class="minicon-search"></span></a></li>
        </ul>
    </div> <!-- /toc-head-->
    <div id="content-header" class="header-main">
        <span id="active-title">{% block active_title %}{% endblock %}</span>
    </div>
    <div class="header-secondary">
        {% block header-secondary %}
        <span class="effective-date"><strong>Effective Date:</strong> {{ meta.effective_date|date }}</span>
        <h2> </h2>
        {% endblock %}
    </div>
</div>
</header>

{% comment %}
    We include the drawer in-line so that we can use blocks
    http://stackoverflow.com/questions/9633387/django-using-blocks-in-included-templates
{% endcomment %}
{% with active_version=version %}
<div id="menu" class="panel" data-reg-id="{{ reg_part }}">
    {% block drawer-toc %}
        {%if TOC %}
            {% with nav_class='regulation-nav' toc_items=TOC top_toc=True %}
                {% include "toc.html" %} 
            {% endwith %}
        {%endif%}
    {% endblock %}
    {% block drawer-history %}
        <div id="history" class="history-drawer toc-container hidden">
            <div class="drawer-header">
                <h2 class="toc-type">Regulation versions</h2>
            </div><!-- /.drawer-header -->
            <div class="drawer-content">
                <div class="form-wrap group">
                <form action="{% url 'redirect_by_date_get' label_id %}"
                      method="GET" class="date-input">
                  <input type="text" name="month" class="month-input" maxlength="2" value="{% now "m" %}" />
                  / <input type="text" name="day" class="day-input" maxlength="2" value="{% now "d" %}" />
                  / <input type="text" name="year" class="year-input" maxlength="4" value="{% now "Y" %}" />
                  <button type="submit">Find</button>
                </form>
                </div><!--./date-form-->
                <div class="group" class="diff-selector">
                    <div class="select-content">
                        <form action="{% url 'diff_redirect' label_id active_version %}" method="GET">
                            <select name="new_version" onChange="this.form.submit();">
                                <option value="default" disabled="disabled" selected="selected">Compare with:</option>
                                {% for version in history %}
                                    {% if active_version != version.version %}
                                        <option value="{{version.version}}">{{version.by_date|date}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </form>
                    </div> <!--/.select-content-->
                </div><!--/.diff-selector-->
                <ul class="version-list">
                {% for version in history %}
                    <li class="{{version.timeline}} status-list" data-base-version="{{version.version}}">
                    {% if reg_part == label_id %}
                        <a href="{% url 'chrome_regulation_view' reg_part version.version %}" class="version-link" data-version="{{ version.version }}">
                            {% if version.timeline == 'current' %}
                                <h4>Current Law</h4>
                            {% endif %}
                            <span class="version-date">{{ version.by_date|date }}</span>
                        </a>
                    {% else %}
                        <a href="{% url 'chrome_section_view' label_id version.version %}" class="version-link" data-version="{{ version.version }}">
                            {% if version.timeline == 'current' %}
                                <h4>Current Law</h4>
                            {% endif %}
                            <span class="version-date">{{ version.by_date|date }}</span>
                        </a>
                    {% endif %}
                        <ul class="rule-list">
                        {% for notice in version.notices %}
                            <li><a class="fr-notice external" href="{{notice.fr_url}}" target="_blank">Final Rule &#8211; {{notice.publication_date|date}}</a></li>
                        {% endfor %}
                        </ul>
                    </li>
                {% endfor %}
                </ul>
            </div>
        </div> <!--/#history-->
    {% endblock %}
    <div id="search" class="search-drawer toc-container hidden">
        <div class="drawer-header">
            <h2 class="toc-type">Search</h2>
        </div><!-- /.drawer-header -->
        <div class="drawer-content">
            <form action="{% url 'chrome_search' reg_part %}" method="GET">
                <div class="search-box">
                    <input type="text" name="q" value="{{ q }}" /><button type="submit"><i class="minicon-search"></i><strong class="icon-text">Search</strong></button>
                </div><!--/.search-box-->
                <div class="version-search">
                    <h4>Searching version</h4>
                    <div class="select-content">
                        <select name="version">
                        {% for version in history %}
                            <option value="{{version.version}}"{% if active_version == version.version %} selected="selected"{% endif %}>{{version.by_date|date}}</option>
                        {% endfor %}
                        </select>
                    </div> <!--/.select-content-->
                </div><!--/.version-search-->
            </form>
        </div><!-- /.drawer-content -->
    </div> <!--/#search-->
</div> <!-- /.panel -->
{% endwith %}

<div class="wrap group">

{% block chrome-content %}
<div id="content-body" class="main-content">
    {% load in_context %}
    {{ main_content|safe }}
    {% begincontext main_content_context main_content_template %}
        {% if main_content_template %}
            {% include main_content_template %}
        {% endif %}
    {% endcontext %}

</div> <!-- /.main-content -->
{% endblock %}

{% block chrome-sidebar %}
{{ sidebar_content|safe }}
{% endblock %}

</div> <!-- /.wrap -->

{% include "footer.html" %}

<div class="breakaway-wrap">
    <div id="breakaway-view" class="breakaway-content"></div>
</div>

{% endblock %}
